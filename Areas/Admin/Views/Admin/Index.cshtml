@model List<GRIT.Web.Models.NewsItem>
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Haber Yönetimi";
}

<div class="container-fluid p-3 p-md-4">

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 mb-md-5 gap-3">

        <div class="text-center text-md-start w-100">
            <h2 class="page-title mb-1">Haber Yönetimi</h2>
            <p class="page-subtitle mb-0">Web sitesindeki içerikleri kart görünümünde yönetin.</p>
        </div>

        <div class="d-flex flex-column flex-md-row gap-2 gap-md-3 w-100 w-md-auto">
            
            <a asp-area="Admin" asp-controller="Admin" asp-action="Logout" 
               class="btn btn-custom-outline-danger d-flex align-items-center justify-content-center w-100 w-md-auto">
                <i class="fas fa-sign-out-alt me-2"></i> Çıkış
            </a>

            <button class="btn btn-custom-primary d-flex align-items-center justify-content-center w-100 w-md-auto" onclick="openModal()">
                <i class="fas fa-plus me-2"></i> Yeni İçerik
            </button>
        </div>

    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert-custom alert-success-custom fade show" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-check-circle me-2"></i> @TempData["Success"]
            </div>
            <button type="button" class="btn-close-custom" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert-custom alert-error-custom fade show" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-exclamation-circle me-2"></i> @TempData["Error"]
            </div>
            <button type="button" class="btn-close-custom" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
        </div>
    }

    @if (Model == null || !Model.Any())
    {
        <div class="empty-state-container">
            <i class="fas fa-newspaper empty-icon"></i>
            <h4 class="mt-3" style="color: var(--text-primary);">Henüz içerik eklenmemiş</h4>
            <p style="color: var(--text-secondary);">Yeni bir haber eklemek için yukarıdaki yeşil butonu kullanın.</p>
        </div>
    }
    else
    {
        <div class="row g-3 g-md-4">
            @foreach (var item in Model)
            {
                <div class="col-12 col-md-6 col-lg-4 col-xl-3">
                    <div class="card h-100 news-card">

                        <div class="img-wrapper">
                            <img src="@(string.IsNullOrEmpty(item.Image) ? "/images/placeholder.png" : item.Image)"
                                 class="card-img-top"
                                 alt="@item.TitleTr"
                                 loading="lazy">

                            <div class="date-badge">
                                <i class="far fa-calendar-alt me-1"></i> @item.Date.ToString("dd MMM")
                            </div>
                        </div>

                        <div class="card-body d-flex flex-column">

                            <div class="mb-2">
                                <span class="category-badge">
                                    @(string.IsNullOrEmpty(item.CategoryTr) ? "Genel" : item.CategoryTr)
                                </span>
                            </div>

                            <h5 class="card-title text-truncate-2" title="@item.TitleTr">
                                @item.TitleTr
                            </h5>

                            <p class="card-text text-truncate-3 flex-grow-1">
                                @(string.IsNullOrEmpty(item.SummaryTr) ? "Özet girilmemiş..." : item.SummaryTr)
                            </p>

                            <div class="card-actions">

                                <button class="btn btn-action-edit flex-grow-1"
                                        onclick='editItem(@Html.Raw(System.Text.Json.JsonSerializer.Serialize(item)))'>
                                    <i class="fas fa-edit me-2"></i> Düzenle
                                </button>

                                <a asp-area="Admin" asp-controller="Admin" asp-action="Delete" asp-route-id="@item.Id"
                                   class="btn btn-action-delete"
                                   onclick="return confirm('Bu içeriği silmek istediğinize emin misiniz?');"
                                   title="Sil">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<partial name="_NewsModal" />



<style>
    /* DESIGN SYSTEM ENTEGRASYONU 
       Global değişkenleri kullanarak override yapıyoruz.
    */

    /* --- TYPOGRAPHY --- */
    .page-title {
        font-family: var(--font-heading);
        color: var(--text-primary);
        font-weight: var(--font-bold);
        font-size: var(--text-3xl);
    }
    .page-subtitle {
        color: var(--text-secondary);
        font-size: var(--text-sm);
    }

    /* --- BUTTONS --- */
    /* Primary (Add New) */
    .btn-custom-primary {
        background: var(--gradient-primary);
        color: var(--white);
        border: none;
        padding: var(--btn-padding-y) var(--btn-padding-x);
        border-radius: var(--btn-border-radius);
        font-weight: var(--font-medium);
        box-shadow: var(--shadow-md);
        transition: var(--transition-normal);
    }
    .btn-custom-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        color: var(--white);
    }

    /* Danger Outline (Logout) */
    .btn-custom-outline-danger {
        background: transparent;
        color: var(--error-main);
        border: 1px solid var(--error-main);
        padding: var(--btn-padding-y) var(--btn-padding-x);
        border-radius: var(--btn-border-radius);
        font-weight: var(--font-medium);
        transition: var(--transition-normal);
    }
    .btn-custom-outline-danger:hover {
        background: var(--error-main);
        color: var(--white);
        box-shadow: var(--shadow-md);
    }

    /* --- ALERTS --- */
    .alert-custom {
        border-radius: var(--radius-md);
        padding: var(--spacing-sm) var(--spacing-md);
        margin-bottom: var(--spacing-md);
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid transparent;
    }
    .alert-success-custom {
        background-color: rgba(46, 125, 50, 0.15); /* success-main opacity */
        border-color: var(--success-dark);
        color: var(--success-light);
    }
    .alert-error-custom {
        background-color: rgba(211, 47, 47, 0.15); /* error-main opacity */
        border-color: var(--error-dark);
        color: var(--error-light);
    }
    .btn-close-custom {
        background: none; border: none; color: inherit; opacity: 0.7; cursor: pointer;
    }
    .btn-close-custom:hover { opacity: 1; }

    /* --- EMPTY STATE --- */
    .empty-state-container {
        text-align: center;
        padding: var(--spacing-xl) 0;
        border: 2px dashed var(--border-color);
        border-radius: var(--radius-lg);
        background-color: rgba(0,0,0,0.1);
    }
    .empty-icon {
        font-size: var(--text-6xl);
        color: var(--text-muted);
        opacity: 0.5;
    }

    /* --- NEWS CARD --- */
    .news-card {
        background-color: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        box-shadow: var(--card-shadow);
        overflow: hidden;
        transition: var(--transition-normal);
    }
    .news-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--card-shadow-hover);
        border-color: var(--primary-main);
    }

    /* Image Area */
    .img-wrapper {
        position: relative;
        overflow: hidden;
        height: 200px;
    }
    .card-img-top {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: var(--transition-slow);
        opacity: 0.9;
    }
    .news-card:hover .card-img-top {
        transform: scale(1.05);
        opacity: 1;
    }

    /* Badges */
    .date-badge {
        position: absolute; top: 10px; right: 10px;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: var(--backdrop-blur);
        color: var(--white);
        font-size: var(--text-xs);
        padding: 4px 10px;
        border-radius: var(--radius-pill);
        border: 1px solid rgba(255,255,255,0.1);
    }
    .category-badge {
        display: inline-block;
        font-size: var(--text-xs);
        font-weight: var(--font-semibold);
        color: var(--primary-light);
        background: rgba(26, 126, 99, 0.15); /* primary opacity */
        padding: 4px 10px;
        border-radius: var(--radius-sm);
        border: 1px solid rgba(26, 126, 99, 0.2);
    }

    /* Content Typography */
    .card-title {
        font-size: var(--text-lg);
        font-weight: var(--font-bold);
        color: var(--text-primary);
        margin-bottom: var(--spacing-xs);
        line-height: var(--leading-snug);
    }
    .card-text {
        font-size: var(--text-sm);
        color: var(--text-secondary);
        line-height: var(--leading-relaxed);
    }

    /* Truncate Helpers */
    .text-truncate-2 {
        display: -webkit-box; -webkit-line-clamp: 2;
        -webkit-box-orient: vertical; overflow: hidden;
    }
    .text-truncate-3 {
        display: -webkit-box; -webkit-line-clamp: 3;
        -webkit-box-orient: vertical; overflow: hidden;
    }

    /* Card Footer Actions */
    .card-actions {
        margin-top: var(--spacing-md);
        padding-top: var(--spacing-sm);
        border-top: 1px solid var(--border-color);
        display: flex;
        gap: var(--spacing-sm);
    }

    .btn-action-edit {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
        padding: 6px 12px;
        border-radius: var(--radius-sm);
        font-size: var(--text-sm);
        transition: var(--transition-fast);
        display: flex; align-items: center; justify-content: center;
    }
    .btn-action-edit:hover {
        border-color: var(--primary-main);
        background: var(--primary-main);
        color: var(--white);
    }

    .btn-action-delete {
        background: transparent;
        color: var(--error-main);
        border: 1px solid var(--border-color);
        padding: 6px 12px;
        border-radius: var(--radius-sm);
        font-size: var(--text-sm);
        transition: var(--transition-fast);
        display: flex; align-items: center; justify-content: center;
    }
    .btn-action-delete:hover {
        border-color: var(--error-main);
        background: var(--error-main);
        color: var(--white);
    }

    /* Mobile Text Adjustment */
    @@media (max-width: 768px) {
    .page-title { font-size: var(--text-2xl); }
    }
</style>